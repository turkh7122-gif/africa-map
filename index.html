<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MILITANT Atlas - AFRICA</title>
  <style>
    /* Mevcut stil bloğun tamamen aynı, değişiklik yok */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Arial, Helvetica, sans-serif; background: #111; color: #eee; height: 100vh; overflow: hidden; touch-action: none; }
    #container { display: flex; height: 100%; }
    #map-area { flex: 1; position: relative; background: #1a1a1a; overflow: hidden; touch-action: none; cursor: grab; }
    svg { width: 100%; height: 100%; display: block; user-select: none; touch-action: none; }
    svg path { fill: #ffffff; stroke: #333; stroke-width: 0.7; transition: fill 0.3s ease, stroke 0.3s ease; pointer-events: all; }
    svg path:hover, svg path:focus { fill: #4ade80; outline: none; }
    svg path:focus-visible { outline: 3px solid #4ade80; outline-offset: 2px; }
    svg path.active { fill: #ff4444 !important; stroke: #fff; stroke-width: 1.8; }
    .tooltip { position: absolute; background: rgba(0,0,0,0.88); color: white; padding: 8px 14px; border-radius: 6px; font-size: 13px; pointer-events: none; display: none; z-index: 100; max-width: 260px; box-shadow: 0 4px 12px rgba(0,0,0,0.6); opacity: 0; transition: opacity 0.18s ease; }
    .tooltip.visible { opacity: 1; }
    .tooltip strong { display: block; font-size: 15px; margin-bottom: 5px; }
    #sidebar { width: 320px; background: #1f1f1f; border-left: 1px solid #333; color: #ddd; padding: 20px; position: relative; overflow-y: auto; display: none; transition: transform 0.3s ease; transform: translateX(100%); touch-action: auto; }
    #sidebar.active { display: block; transform: translateX(0); }
    #sidebar-close { position: absolute; top: 12px; right: 12px; width: 36px; height: 36px; background: #444; color: white; border: none; border-radius: 50%; font-size: 24px; line-height: 34px; text-align: center; cursor: pointer; transition: all 0.2s; }
    #sidebar-close:hover { background: #666; transform: scale(1.08); }
    #search-container { margin-bottom: 18px; }
    #search-input { width: 100%; padding: 10px 12px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 6px; font-size: 15px; }
    #search-input::placeholder { color: #888; }
    .group { margin: 14px 0; padding: 10px; background: #2a2a2a; border-radius: 6px; }
    .group a { color: #4ade80; text-decoration: none; font-size: 14.5px; }
    .group a:hover { text-decoration: underline; }
    @media (max-width: 768px) {
      #container { flex-direction: column; }
      #map-area { flex: 1 1 60%; }
      #sidebar { width: 100%; height: auto; max-height: 60%; min-height: 40%; position: fixed; bottom: 0; left: 0; right: 0; transform: translateY(100%); border-left: none; border-top: 1px solid #444; background: #1f1f1f; z-index: 200; overflow-y: auto; touch-action: pan-y pinch-zoom; -webkit-overflow-scrolling: touch; }
      #sidebar.active { transform: translateY(0); }
      #sidebar-close { top: 12px; right: 12px; z-index: 201; }
      #sidebar-content { padding-bottom: 60px; }
    }
  </style>
</head>
<body>
<div id="container">
  <div id="map-area">
    <svg id="svg-map" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
      <!-- Senin path'lerin tamamen aynı, değişiklik yok -->
      <path inkscape:connector-curvature="0" id="AO" data-name="Angola" data-id="AO" d="m 495.3,598.6 ... z" />
      <!-- ... diğer path'ler ... -->
      <path inkscape:connector-curvature="0" id="EH" data-name="W. Sahara" data-id="EH" d="m 193.8,134.6 ... z" />
      <path inkscape:connector-curvature="0" id="SZ" data-name="Swaziland" data-id="SZ" d="m 674,874.9 ... z" />
      <!-- ... kalan path'ler ... -->
    </svg>
    <div class="tooltip" id="tooltip"></div>
  </div>
  <div id="sidebar">
    <button id="sidebar-close">×</button>
    <div id="search-container">
      <input type="text" id="search-input" placeholder="Search...">
    </div>
    <div id="sidebar-content"></div>
  </div>
</div>

<script>
// Değişiklik yapılan yerler yorumlandı
const tooltip = document.getElementById("tooltip");
const sidebar = document.getElementById("sidebar");
const sidebarContent = document.getElementById("sidebar-content");
const searchInput = document.getElementById("search-input");
const svg = document.getElementById("svg-map");
const mapArea = document.getElementById("map-area");

let countryData = {};
let activePath = null;

let viewBox = { x: 0, y: 0, w: 1000, h: 1000 };
let isPanning = false;
let startPoint = { x: 0, y: 0 };

const originalWidth = 1000;
const originalHeight = 1000;

let prevDist = 0;
let prevMid = { x: 0, y: 0 };

fetch("data.json")
  .then(res => res.json())
  .then(data => {
    countryData = data;
    console.log("Veri yüklendi:", Object.keys(countryData)); // Konsolda hangi ülkeler var gör
    initMap();
  })
  .catch(err => {
    console.error("data.json yüklenemedi:", err);
    sidebarContent.innerHTML = "<p style='color:#f66;'>Veri dosyası yüklenemedi.</p>";
  });

function initMap() {
  const paths = document.querySelectorAll("svg path");
  paths.forEach(path => {
    const id = path.id.trim(); // boşluk vs. temizle
    if (!countryData[id]) {
      console.warn(`Ülke verisi eksik: ${id}`); // Eksik ülkeleri konsolda göster
      return;
    }

    const enterHandler = (e) => {
      if (e.touches && e.touches.length > 1) return;
      const data = countryData[id];
      tooltip.innerHTML = `
        <strong>${data.name || id}</strong><br>
        ${data.groups?.map(g => g.name).join("<br>") || "Grup bilgisi yok"}
      `;
      tooltip.classList.add("visible");
      tooltip.style.display = "block";
      moveTooltip(e);
      console.log(`Hover: ${id}`); // debug
    };

    path.addEventListener("mouseenter", enterHandler);
    path.addEventListener("touchstart", enterHandler, { passive: true });

    path.addEventListener("mousemove", moveTooltip);
    path.addEventListener("touchmove", moveTooltip, { passive: true });

    path.addEventListener("click", () => {
      console.log(`Tıklama: ${id}`); // debug: tıklandı mı?
      if (activePath) activePath.classList.remove("active");
      path.classList.add("active");
      activePath = path;
      showSidebar(id);
    });

    path.addEventListener("touchend", (e) => {
      if (e.touches.length === 0) {
        path.dispatchEvent(new Event("click"));
      }
    }, { passive: true });
  });

  // ... kalan event listener'lar aynı (mouseleave, wheel, pointer, touch vs.)
  // Kodu kısaltmak için burayı atlıyorum, senin kodundaki gibi bırak
}

// showSidebar fonksiyonuna fallback ekle
function showSidebar(id) {
  const data = countryData[id.trim()];
  if (!data) {
    sidebarContent.innerHTML = `<p style="color:#f66;">${id} için veri bulunamadı.</p>`;
    sidebar.classList.add("active");
    return;
  }

  let html = `<h2 style="margin-top:0;">${data.name || id}</h2>`;
  if (data.groups && data.groups.length > 0) {
    data.groups.forEach(group => {
      html += `
        <div class="group">
          <a href="${group.url || '#'}" target="_blank" rel="noopener noreferrer">
            ${group.name}
          </a>
        </div>
      `;
    });
  } else {
    html += "<p>Bu bölge için grup bilgisi bulunmuyor.</p>";
  }

  sidebarContent.innerHTML = html;
  sidebar.classList.add("active");
  sidebarContent.scrollTop = 0;
}

// ... kalan fonksiyonlar (updateViewBox, clampViewBox, onWheel, getMousePos, onPointerDown vs.) tamamen aynı kalıyor

// Debug için ekstra log
console.log("initMap çağrıldı, path sayısı:", document.querySelectorAll("svg path").length);
</script>
</body>
</html>
